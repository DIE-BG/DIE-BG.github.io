---
title: "Simulation exercise under HV scheme"
author: "DIE"
format: 
    revealjs:
        scrollable: true
        incremental: false
        slide-number: true
        smaller: true
        progress: true
        controls: true
        controls-back-arrows: faded
    pdf: default    
bibliography: reference.bib
lang: es
---

# Introducción

El objetivo del ejercicio fue aislar el efecto del tamaño de muestra sobre los resultados del esquema $HV$. Luego se intentó calibrar un valor óptimo para el parámetro $H$ para implementar este esquema en la metodología de Selección de Modelos DIE. Algunas consideraciones clave son:

#
::: {.incremental}
- $N$ es el número total de observaciones.
- $H$ es el parámetro que controla la dependencia temporal de los datos. 
- $V$ es el parámetro que se utiliza para establecer el tamaño de la muestra de validación. Creemos que un valor apropiado para este parámetro es $V = 6$^[Con $V = 6$ la muestra de validación es 13, o 3 años].
:::

# 
::: {.incremental}
- $N_T$ es el tamaño de la muestra de entrenamiento. Bajo el esquema $HV$ el tamaño de muestra esta dado por: 
- $N_T = N - 2H - 2V -1$
- A partir de las pruebas y el estudio matemático del Conjunto Mínimo de Entrenamiento ($CME$), definimos el $CME$ igual a 16, por lo que dado el $CME$ y $V = 6$, el valor máximo de $H$ es 23.

- Por lo que para el presente ejercicio $H$ se estableció en el rango de 0 a 23.
:::

## Ejercicio
Dado que $H$ se estableció en el intervalo de 0 a 23, generamos todas las combinaciones posibles para cada $H$ con $V = 6$ fijo, así que las combinaciones posibles fueron 24.

$$
    \begin{align}
    \text{Combinación 1, } H=0, V=6, N_T=63\\
    \text{Combinación 2, } H=1, V=6, N_T=61\\
    \text{Combinación 3, } H=2, V=6, N_T=59\\
    \vdots \\
    \text{Combinación 24, } H=23, V=6, N_T=17
    \end{align}
$$

Para cada combinación generamos todas las submuestras posibles obteniendo sus $RMSEs$ fuera de muestra. El objetivo es comparar el comportamiento del error a medida que el tamaño de la muestra aumenta^[Hay una relación inversa entre $H$ y $N_T$].

# Resultados

## RMSE por Variable Objetivo
![RMSE por Variable Objetivo](images/hv_exercise/RMSEByVariables.png)

## RMSE Promedio de las Variables Objetivo
![Promedio de RMSE](images/hv_exercise/RMSEAverage.png)

## Hallazgos de las Variables Objetivo
- Para la mayoría de las variables objetivo, el $RMSE$ disminuye a medida que el tamaño de la muestra aumenta.
- La inflación total muestra un patrón diferente en los dos primeros horizontes de validación.
- El $RMSE$ de la inflación total muestra el mismo patrón que el resto de variables objetivo a partir del horizonte tres.
- A medida que el parámetro $H$ aumenta, el $RMSE$ también aumenta.^[Como se observa en los resultados de @burman1994cross (@tbl-results). Creemos que valores bajos de $H$ tienden a subestimar el *error* verdadero y valores altos tienden a sobreestimarlo.]

## Hallazgos del Promedio de Variables Objetivo
- En los dos primeros horizontes el promedio estuvo dominado por el tipo de cambio, el producto y la tasa de interés.
- El promedio en todos los horizontes tiende a disminuir a medida que aumenta el tamaño de muestra.
- **Dado que el RMSE tiende a subestimarse con valores bajos de H y sobreestimarse con valores altos, probablemente sea más apropiado seleccionar H dentro de un rango de valores.**

## Análisis de RMSE
Con base en los resultados, intentamos encontrar un conjunto óptimo de valores para $H$. Para hacerlo, procedimos de la siguiente manera:

:::{.incremental}
- Se obtuvo el rango intercuartílico de los valores de $RMSE$ para cada variable objetivo.
- Se identificaron los valores de $H$ dentro de este rango.
- Se determinó la intersección de los valores de $H$ entre todas las variables objetivo.
- Finalmente, este proceso se realizó para los horizontes de validación 1, 2, 3 y 4.
:::

# 
**Ejemplo: horizonte 1 con dos variables objetivo**

|    d4_ln_cpi     |             |    d4_ln_s      |             |
|:----------------:|:--------:   |:---------------:|:-----------:|
|   Ejercicio H    |  RMSE       |   Ejercicio H   |  RMSE       |
|  H0_N63          |  1.2084     |  H0_N63         |  1.6575     |
|  H3_N57          |  1.2088     |  H1_N61         |  1.6588     |
|  H4_N55          |  1.2079     |  H2_N59         |  1.6521     |
|  H5_N53          |  1.2072     |  H5_N53         |  1.6543     |
|  H6_N51          |  1.2061     |  H6_N51         |  1.6677     |
|  H7_N49          |  1.2057     |  H7_N49         |  1.6871     |
|  H8_N47          |  1.2053     |  H8_N47         |  1.7076     |
|  $\vdots$        | $\vdots$    |  $\vdots$       | $\vdots$    |
|  H23_N17         |  1.2061     |  H21_N21        |  1.9238     |
: RMSE dentro del rango intercuartílico.

Como se puede ver en la tabla, algunos valores de $H$ están en ambas variables. Hicimos esto para todas las variables y seleccionamos aquellos valores de $H$ que están en todas las variables^[En cada variable los resultados del ejercicio de H fueron identificados con base en el rango intercuartílico del RMSE].

## Resultados del análisis de intersección
| horizonte 1        | horizonte 2     | horizonte 3     | horizonte 4     |
|--------------------|-----------------|-----------------|-----------------|
| **H6_N51**         |  -------------- |  -------------- | --------------  |
| H7_N49             |  -------------- |  -------------- | --------------  |
| H8_N47             |  -------------- |  -------------- | --------------  |
| H9_N45             |  -------------- |  -------------- | --------------  |
| H10_N43            |  -------------- |  H10_N43        | H10_N43         |
| H11_N41            |  H11_N41        |  H11_N41        | H11_N41         |
| H12_N39            |  H12_N39        |  H12_N39        | H12_N39         |
| H13_N37            |  H13_N37        |  H13_N37        | H13_N37         |
| **H14_N35**        |  H14_N35        |  H14_N35        | H14_N35         |
| --------------     |  H15_N33        |  H15_N33        | H15_N33         |
| --------------     |  H16_N31        |  H16_N31        | H16_N31         |
\* RMSE dentro de Q1 y Q3  
\* El resultado para cada horizonte es la intersección de las variables objetivo

#
![H de 1 a 4 dentro de Q1 y Q3](images/hv_exercise/RMSE_hv_h_1_4.png)

#
![H de 6 a 14 dentro de Q1 y Q3](images/hv_exercise/RMSE_hv_h_6_14.png)

#
![H de 4 a 16 dentro de Q1 y Q3](images/hv_exercise/RMSE_hv_h_4_16.png)

# Comparación del rendimiento del método HV Block: 
Comparamos el rendimiento del método HV Block con el Método OS Multiple aplicado actualmente. Para este ejercicio definimos tres rangos de valores de $H$.

1. $H$ de 4 a 9
2. $H$ de 4 a 16
3. $H$ de 6 a 14

El conjunto de datos cubre desde 2005T1 hasta 2024T4.

# Resultados de la comparación

# Coeficiente de Variación
![](images/hv_exercise/ComparativeDispersion.png)

# Error Cuadrático Medio
![](images/hv_exercise/ComparativeLoss.png)


# Comentarios Finales

:::{.incremental}
- Valores bajos del parámetro $H$ están asociados con un RMSE bajo (posiblemente subestimado), el cual aumenta conforme incrementa $H$.
- Creemos que no hay un valor único óptimo de $H$; en su lugar, preferimos un rango de valores.
- El rango de valores de $H$ fue identificado mediante el análisis del rango intercuartílico del RMSE.
- Debido a la importancia del horizonte 1 en los pronósticos y error de validación, creemos que los valores de $H$ contenidos en este horizonte (**de 6 a 14**) son adecuados para Ejercicios de Selección de Modelos dentro del esquema HV.
- La comparación muestra que el método HV Block y el Método OS Multiple presentan un patrón similar en los resultados agregados del CVr y del RMSE a lo largo de los horizontes de validación.
:::

# referencias
